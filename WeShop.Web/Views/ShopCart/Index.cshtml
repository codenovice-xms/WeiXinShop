@model IEnumerable<WeShop.EFModel.ShoppingCart>
@{
    ViewBag.Title = "购物车";
    Layout = "~/Views/_LayoutNav.cshtml";
}
@section Style{
    <style>
        label>* {pointer-events: auto;}
    </style>
}
@section Script
{
    <script>
        if (@Model.Count()<1) {
            $(".nullcar").css('display','block');
            $("#but").css('display', 'none');
            $(".shopcar").css('display','none'); 
        } else {
            $(".nullcar").css('display','none');
            $("#but").css('display', 'block');
            $(".shopcar").css('display','block'); 
        }
        $(function() {
            var jian = $(".jian");
            var jia = $(".jia");
            var kunchun = 10; //当库存不足时，可以提醒用户。
            jia.click(function() {
                var n = $(this).siblings("input").val();
                n++;
                if (n > kunchun) {
                    alert("库存不足啦!");
                    $(this).siblings("input").val(kunchun - 1);
                    return false;
                }
                $(this).siblings("input").val(n);
                return false;
            });
            jian.click(function() {
                var n = $(this).siblings("input").val();
                n--;
                if (n < 1) {
                    $(this).siblings("input").val(n + 1);
                    return false;
                }
                $(this).siblings("input").val(n);
                return false;
            });

            $("label input").click(function() {
                $(this).parent().toggleClass("on");
                var flag = 1;
                $("label input").each(function() {
                    if (!this.checked) {
                        flag = 0;
                    }
                });
                if (flag === 1) {
                    $(".car_pay span").addClass("on");
                } else {
                    $(".car_pay span").removeClass("on");
                }
            });
            $(".pay label span").click(function() {
                if ($(this).hasClass("on")) {
                    $(this).removeClass("on");
                    $("label input").prop("checked", false);
                    $("label").removeClass("on");
                } else {
                    $(this).addClass("on");
                    $("label input").prop("checked", true);
                    $("label").addClass("on");
                }
            });

            $(".ftop .all").click(function() {
                var val = $(this).html();
                if (val == "编辑") {
                    $(this).html("完成");
                } else {
                    $(this).html("编辑");
                }
            });

            $(".ftop .all").click(function() {
                $(".shopcar ul li .delete").toggle();
            });
        });
    </script>
    <script>
        $(".car").addClass("current");
        $(".sort").removeClass("current");
        $(".home").removeClass("current");
        $(".my").removeClass("current");
    </script>
    <script>
        //购物车删除商品
        $('.delete').click(function() {
            var that = this;
            $.confirm("是否确认删除？", function() {
                $.ajax({
                    url: '@Url.Action("DeleteCar", "ShopCart")',
                    type: 'POST',
                    data: { procode: $(that).data('procode') }
                }).done(function(res) {
                    if (res === '200') {
                        $(that).parents('li').remove();
                        var carnum = document.getElementById("carnum");
                        var linum = carnum.getElementsByTagName("li");
                        if (linum.length<1) {
                            $(".nullcar").css('display','block');
                            $("#but").css('display', 'none');
                            $(".shopcar").css('display','none');
                        } else {
                            $(".nullcar").css('display','none');
                            $("#but").css('display', 'block');
                            $(".shopcar").css('display','block');
                        }
                    } else
                        $.toptip('删除失败', 'error');
                }).error(function() {
                    $.toptip("未知错误");
                });
            }, function() {
                console.log("已取消");
            });
        });

        $("#but_left").click(function() {
            var that = this.parent("input").value;
            console.log(that);
        });
        $("#but_right").click(function() {
            var that = this.parent("input").value;
            console.log(that);
        });
    </script>
}
<!--ftop开始-->
<div class="ftop">
    <h3 style="font-size: 18px; text-align: center;">购物车</h3>
    <a style="color: #333; font-size: 14px; position: absolute; right: 15px; top: 4px;" class="all" id="but">编辑</a>
    <div style="clear: both;"></div>
</div>
<!--ftop结束-->
<div class="shopcar" style="margin-bottom: 30px;">
    <ul id="carnum">
        @foreach (var shopcar in Model)
        {
            <li>
                <p>
                    <label>
                        <input type="checkbox">
                    </label><a href="@Url.Action("Index", "ProDetails", new {Code = @shopcar.ProCode})">
                        <img src="@shopcar.Product.ProPhotoes.First().ImgUrl">
                    </a>
                </p>
                <div class="shop_car">
                    <a href="@Url.Action("Index", "ProDetails")">@shopcar.Product.Name</a>
                    <span>单价：@shopcar.Product.SellPrice</span>
                    <div class="shu">
                        <span class="jian"><img id="but_left" src="/Content/images/icon_016.png"></span><input class="shopcart-td-num" type="text" value="@shopcar.Qty"/><span class="jia"><img id="but_right" src="/Content/images/icon_017.png"></span><a>
                            <i>单品总价：￥</i><b>@(@shopcar.Product.SellPrice*@shopcar.Qty)</b>
                        </a>
                    </div>
                </div>
                <img class="delete" data-procode="@shopcar.ProCode" src="/Content/images/icon_030.png">
            </li>
        }
    </ul>
    <div class="pay">
        <label>
            <input type="checkbox"><span>全选</span></label>
        <div class="pay_right">
            <p>
                <span>合计：<b>￥898.50</b></span><i>不含运费</i>
            </p>
            <a href="confirm_order.html">结算</a>
        </div>
    </div>
</div>
<div class="nullcar" style="display:none">
    <div class="shopcar_null">
        <img src="/Content/images/car.jpg">
        <span>您的购物车空空如也</span>
        <p><a class="person" href="@Url.Action("Index","User")">个人中心</a><a href="@Url.Action("Index","Home")">马上去逛逛</a></p>
    </div>
</div>